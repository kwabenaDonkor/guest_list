<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Find Your Table</title>
  <style>
    :root { --bg:#fafafa; --card:#ffffff; --text:#111827; --muted:#6b7280; --accent:#8b5cf6; --radius:16px; }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";color:var(--text);background:var(--bg)}
    header{padding:28px 16px 8px;text-align:center}
    h1{margin:0 0 8px;font-size:clamp(22px,3.5vw,36px)}
    .sub{color:var(--muted);margin:0 0 20px}
    .container{max-width:780px;margin:0 auto;padding:12px 16px 40px;display:grid;gap:16px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 4px 24px rgba(0,0,0,.06);padding:16px}
    .input{width:100%;padding:14px 16px;border-radius:12px;border:1px solid #e5e7eb;font-size:16px;outline:none}
    .input:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(139,92,246,.15)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-size:14px}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .results{margin-top:10px;display:grid;gap:10px}
    .result{border:1px solid #f1f5f9;padding:12px;border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:space-between}
    .name{font-weight:600}
    .table{font-variant-numeric:tabular-nums;padding:6px 10px;border-radius:999px;background:#f3f4f6}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    details{border:1px dashed #e5e7eb;border-radius:12px;padding:12px}
    summary{cursor:pointer;font-weight:600}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#4338ca;font-weight:600}
    .grid{display:grid;gap:8px}
    .qr-wrap{display:flex;align-items:center;justify-content:center;padding:16px;background:#fff;border:1px solid #e5e7eb;border-radius:12px}
    .footer{margin-top:18px;text-align:center;color:var(--muted);font-size:12px}
    .admin-badge{font-size:12px;color:#065f46;background:#d1fae5;display:inline-block;padding:4px 8px;border-radius:999px;font-weight:600}
    .admin-only{display:none !important}
    body.admin-on .admin-only{display:block !important}
    .gift-line{display:flex;align-items:center;gap:10px}
    .flag{font-size:20px;line-height:1}
    .gift-text{font-size:16px}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
</head>
<body>
  <header>
    <h1>Find Your Table</h1>
    <p class="sub">Type your name to see your table number</p>
  </header>

  <main class="container">
    <!-- 1) Name Search -->
    <section class="card">
      <div class="grid" style="gap:12px">
        <input id="search" class="input" type="text" placeholder="Start typing your first or last name‚Ä¶" autocomplete="name" />
        <div class="small muted">Tip: You can search by first name, last name, or any part of the name. Accents and case don‚Äôt matter.</div>
        <div id="results" class="results"></div>
      </div>
    </section>

    <!-- 2) Per-table lists (next) -->
    <section class="card">
      <details>
        <summary>View per‚Äëtable lists</summary>
        <div id="byTable" class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px"></div>
      </details>
    </section>

    <!-- 3) Gift info (new section) -->
    <section class="card">
      <div class="grid" style="gap:10px">
        <div><strong>Leave Us a Gift at:</strong></div>
        <div class="gift-line">
          <span class="flag" aria-label="Canada">üá®üá¶</span>
          <span class="gift-text">e‚Äëtransfer: <strong>gasare@gmail.com</strong></span>
        </div>
        <div class="gift-line">
          <span class="flag" aria-label="United States">üá∫üá∏</span>
          <span class="gift-text">Zelle: <strong>+1 510‚Äë324‚Äë9171</strong> <span class="muted">(Kwabena Donkor)</span></span>
        </div>
      </div>
    </section>

    <!-- 4) QR code at the very bottom -->
    <section class="card">
      <div class="grid" style="gap:10px">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
          <strong>QR for this page</strong>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button id="qrRefresh" class="btn">Refresh</button>
            <button id="qrSave" class="btn">Save PNG</button>
          </div>
        </div>
        <div id="qrcode" class="qr-wrap" aria-label="QR Code for this page"></div>
        <div class="small muted">LOVE CONQUERS ALL</div>
      </div>
    </section>

    <!-- Admin panel (hidden unless admin) placed after main content -->
    <section id="adminPanel" class="admin-only card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;margin-bottom:6px;">
        <strong>Admin: Data Loader</strong>
        <span class="admin-badge" id="adminBadge">ADMIN MODE</span>
      </div>
      <div class="grid" style="gap:10px">
        <textarea id="paste" class="input" rows="6" placeholder="Paste lines like:\nFirst Last, Table 8\nAma Mensah, 12\nKofi Boateng, 5"></textarea>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button id="loadData" class="btn primary">Load Pasted Data</button>
          <button id="downloadExample" class="btn">Download Example HTML (with your data)</button>
        </div>
        <div class="small muted">Admin-only. Paste ‚ÄúName, Table‚Äù per line and click Load. Then test search above.</div>
      </div>
    </section>

    <p class="footer">‚ô• We appreciate you celebrating with us. God bless you ‚ô•</p>
  </main>

  <script>
    // ------------ Admin gate (robust) --------------------------------------
    const ADMIN_CODE = 'kds'; // change if you want a different passcode

    function enableAdmin(){
      document.body.classList.add('admin-on');
      sessionStorage.setItem('admin','1');
      try{ const url=new URL(location.href); if(url.searchParams.has('admin')){ url.searchParams.delete('admin'); history.replaceState({},'',url.toString()); } }catch(e){}
    }
    function tryURLAdmin(){
      try{ const p=new URLSearchParams(location.search); const code=p.get('admin'); if(code && code===ADMIN_CODE){ enableAdmin(); } }catch(e){}
    }
    function wireAdminShortcut(){
      document.addEventListener('keydown', (e)=>{
        if(e.ctrlKey && e.shiftKey && (e.key==='A' || e.key==='a')){
          const code=prompt('Enter admin passcode');
          if(code && code===ADMIN_CODE){ enableAdmin(); alert('Admin mode enabled'); }
          else if(code){ alert('Incorrect passcode'); }
        }
      });
      if(sessionStorage.getItem('admin')==='1'){ document.body.classList.add('admin-on'); }
    }

    // ------------ Data (YOUR LIST, no placeholders) ------------------------
    let GUESTS = [
      {"name":"Mr Otoabaa Asare-Baffour","table":"1"},
      {"name":"Kelsy Evelyn Dundas","table":"12"},
      {"name":"Tarah Paul","table":"12"},
      {"name":"Mary Manu","table":"13"},
      {"name":"Agyeman Opoku","table":"13"},
      {"name":"Mr. Samuel Boakye-Mensah","table":"13"},
      {"name":"Mrs. Haggar Opoku Mensah","table":"13"},
      {"name":"Mr Raoul Gombar","table":"13"},
      {"name":"Mrs Matilda Manu Gombar","table":"13"},
      {"name":"Hana Manu","table":"13"},
      {"name":"Ruth Manu","table":"13"},
      {"name":"Abel Manu","table":"13"},
      {"name":"S K Dankwah","table":"13"},
      {"name":"Rita Yeboah","table":"13"},
      {"name":"Mary Amofa","table":"14"},
      {"name":"Lola Umebuani","table":"14"},
      {"name":"Oppong Antwi","table":"14"},
      {"name":"Mr Parfait Migisha","table":"14"},
      {"name":"Mrs Allison Migisha","table":"14"},
      {"name":"Robell Nyirendah","table":"14"},
      {"name":"Alex Harris","table":"14"},
      {"name":"Nils Bonfils","table":"14"},
      {"name":"Sayaka Ri","table":"14"},
      {"name":"Rashad Idris","table":"14"},
      {"name":"Kenneth Gyabaa","table":"15"},
      {"name":"Mr. Emmanuel Afrane Sarpong","table":"15"},
      {"name":"Mrs. Abigail Adjei","table":"15"},
      {"name":"Kwazi Opoku-Ware","table":"15"},
      {"name":"Elikem Worwui-Brown","table":"15"},
      {"name":"George Acheampong","table":"15"},
      {"name":"Joash Ataakorerkpa","table":"15"},
      {"name":"Jake Annor Darko Ebenezer","table":"15"},
      {"name":"Nana Opoku Achempim","table":"15"},
      {"name":"Richard Boateng","table":"15"},
      {"name":"Kingsley Kwarteng","table":"15"},
      {"name":"Jeremy Afrifa","table":"16"},
      {"name":"Hillary Owusu","table":"16"},
      {"name":"Helena Opoku-Ware","table":"16"},
      {"name":"Chelsea Afrifa","table":"16"},
      {"name":"Stephanie Sarpong","table":"16"},
      {"name":"Ashley Opoku-Ware","table":"16"},
      {"name":"Sherserry Anum","table":"16"},
      {"name":"Joseph Allen","table":"16"},
      {"name":"Loretta Ampadu","table":"16"},
      {"name":"Ikemefuna Ekweozor","table":"16"},
      {"name":"Asante Dickson","table":"16"},
      {"name":"Salafina Owusu","table":"17"},
      {"name":"Mila Oppong Antwi","table":"17"},
      {"name":"Desmond Mensah","table":"17"},
      {"name":"Naomi Ofori","table":"17"},
      {"name":"Isabelle Amoako","table":"17"},
      {"name":"Angela (Angiie) Yeboah","table":"17"},
      {"name":"Kimberly Ofori","table":"17"},
      {"name":"Linda Ofori","table":"17"},
      {"name":"Gabriel Konadu-Okyere","table":"17"},
      {"name":"Vera Serwaa Safo","table":"17"},
      {"name":"Obed Gyasi","table":"17"},
      {"name":"Natalie Akrofi","table":"18"},
      {"name":"Emanuella Ampofo","table":"18"},
      {"name":"Vivien Schroeder","table":"18"},
      {"name":"Abena Konadu","table":"18"},
      {"name":"Vince Addai","table":"18"},
      {"name":"MC Shegelabobor","table":"18"},
      {"name":"Joseph Archibold","table":"18"},
      {"name":"Evania Pokua Kyei","table":"18"},
      {"name":"Yaw Kuma","table":"18"},
      {"name":"Brookman Amissah","table":"18"}
    ];

    // ------------ Utilities -------------------------------------------------
    const norm = s => (s||"").toString().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();

    function cleanAndSort(data){
      return data
        .filter(x=>x && x.name && x.table)
        .map(x=>({ name: x.name.toString().trim(), table: x.table.toString().trim() }))
        .sort((a,b)=>a.name.localeCompare(b.name));
    }

    function groupByTable(data){
      const groups = new Map();
      for(const g of data){ const k=g.table.toString(); if(!groups.has(k)) groups.set(k,[]); groups.get(k).push(g); }
      for(const [k,arr] of groups){ arr.sort((a,b)=>a.name.localeCompare(b.name)); }
      return Array.from(groups.entries()).sort((a,b)=>{ const na=Number(a[0]), nb=Number(b[0]); return (!isNaN(na)&&!isNaN(nb)) ? na-nb : a[0].localeCompare(b[0]); });
    }

    function searchGuests(query,data){
      const q = norm(query); if(!q) return [];
      const tokens = q.split(/\s+/).filter(Boolean);
      return data.map(g=>{ const n=norm(g.name); let score=0; if(n.includes(q)) score+=2; for(const t of tokens){ if(n.includes(t)) score+=1; } return {g,score}; })
                 .filter(x=>x.score>0)
                 .sort((a,b)=>b.score-a.score || a.g.name.localeCompare(b.g.name))
                 .map(x=>x.g).slice(0,20);
    }

    function renderResults(list){
      const el=document.getElementById('results'); el.innerHTML='';
      if(list.length===0){ el.innerHTML='<div class="muted">No matches yet. Keep typing‚Ä¶</div>'; return; }
      for(const r of list){
        const div=document.createElement('div'); div.className='result';
        div.innerHTML=`<div class="name">${escapeHtml(r.name)}</div><div class="table" aria-label="Table Number">Table ${escapeHtml(r.table)}</div>`;
        el.appendChild(div);
      }
    }

    function renderTables(data){
      const container=document.getElementById('byTable'); container.innerHTML='';
      const groups=groupByTable(data);
      for(const [table,list] of groups){
        const card=document.createElement('div'); card.className='card';
        const items=list.map(x=>`<div>${escapeHtml(x.name)}</div>`).join('');
        card.innerHTML=`<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px"><span class="pill">Table ${escapeHtml(table)}</span><span class="small muted">${list.length} guest${list.length!==1?'s':''}</span></div>${items}`;
        container.appendChild(card);
      }
    }

    function escapeHtml(s){ return s.replace(/[&<>\"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c])); }

    // Bake current data into a new standalone HTML download
    function downloadSelfContained(){
      const blob = new Blob([document.documentElement.outerHTML.replace(/let GUESTS = \[[\s\S]*?\];/,'let GUESTS = '+JSON.stringify(GUESTS,null,2)+';')], {type:'text/html;charset=utf-8'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='index.html'; a.click(); URL.revokeObjectURL(a.href);
    }

    // ------------ QR --------------------------------------------------------
    function makeQR(){
      const box=document.getElementById('qrcode'); box.innerHTML='';
      const url=location.href; new QRCode(box,{text:url,width:220,height:220,correctLevel:QRCode.CorrectLevel.M});
    }
    function saveQR(){
      const canvas=document.querySelector('#qrcode canvas');
      if(canvas){ const a=document.createElement('a'); a.href=canvas.toDataURL('image/png'); a.download='wedding-qr.png'; a.click(); return; }
      const img=document.querySelector('#qrcode img');
      if(!img){ alert('QR not ready yet'); return; }
      const c=document.createElement('canvas'); const ctx=c.getContext('2d'); c.width=img.naturalWidth; c.height=img.naturalHeight; ctx.drawImage(img,0,0);
      const a=document.createElement('a'); a.href=c.toDataURL('image/png'); a.download='wedding-qr.png'; a.click();
    }

    // ------------ Event wiring ---------------------------------------------
    function hydrate(){
      wireAdminShortcut();
      tryURLAdmin();

      GUESTS = cleanAndSort(GUESTS);
      renderTables(GUESTS);
      renderResults([]);
      makeQR();

      const search=document.getElementById('search');
      search.addEventListener('input',()=>{ renderResults(searchGuests(search.value,GUESTS)); });

      document.getElementById('qrRefresh').addEventListener('click', makeQR);
      document.getElementById('qrSave').addEventListener('click', saveQR);

      const loadBtn=document.getElementById('loadData');
      if(loadBtn){
        loadBtn.addEventListener('click',()=>{
          const raw=document.getElementById('paste').value.trim();
          if(!raw){ alert('Paste lines like:\nFirst Last, 8'); return; }
          const lines=raw.split(/\n+/); const parsed=[];
          for(const line of lines){ const m=line.split(','); if(m.length>=2){ const name=m[0].trim(); const table=m.slice(1).join(',').trim(); if(name&&table){ parsed.push({name,table}); } } }
          if(parsed.length===0){ alert('Could not parse any rows. Ensure each line has a comma separating name and table.'); return; }
          GUESTS=cleanAndSort(parsed);
          document.getElementById('paste').value=''; document.getElementById('search').value='';
          renderTables(GUESTS); renderResults([]);
          alert('Guest list loaded. Try searching!');
        });
      }

      const dlBtn=document.getElementById('downloadExample');
      if(dlBtn){ dlBtn.addEventListener('click', downloadSelfContained); }
    }

    document.addEventListener('DOMContentLoaded', hydrate);
  </script>
</body>
</html>